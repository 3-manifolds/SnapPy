#! /usr/bin/env python

import os, sys

packages = ['FXrays', 'cypari', 'plink', 'spherogram', 'snappy']
pythons = ['py26', 'py27', 'py33', 'py34', 'py35']

args = sys.argv[1:]

if 'pyall' in args or len(set(pythons)&set(args)) == 0:
    args = [a for a in args + pythons if a != 'pyall']
    
if not set(packages + pythons).issuperset(set(args)):
    print('At least one invalid argument, sorry')
else:
    packages = [p for p in packages if p in args]
    pythons = [p for p in pythons if p in args]
    print('*** Will compile %s using %s *** \n\n' % (packages, pythons))
    for package in packages:
        os.chdir('/build/' + package)
        os.system('hg pull -u')
        first_build = True
        for python in pythons:
            os.system(python + ' setup.py install')
            if package == 'snappy':
                os.system(python + ' setup.py build_docs install')
            if first_build:
                os.system(python + ' setup.py sdist')
                first_build = False
            if package != 'plink':
                os.system(python + ' setup.py bdist_wheel')
            print('\n*** Finished %s with %s ***\n\n' %
                      (package, python))
